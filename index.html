<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Vadisi Reports</title>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f6f8fa;
      margin: 0;
      padding: 0;
    }
    header {
      background: #111;
      color: #fff;
      text-align: center;
      padding: 15px 0;
      font-size: 20px;
      letter-spacing: 1px;
    }
    .container {
      width: 90%;
      max-width: 1200px;
      margin: 20px auto;
      background: white;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    h2 {
      margin-top: 0;
      color: #333;
    }
    form {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
      margin-bottom: 20px;
    }
    input, select, button {
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 14px;
    }
    button {
      background: #111;
      color: white;
      cursor: pointer;
    }
    button:hover {
      background: #444;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }
    th, td {
      border: 1px solid #ddd;
      text-align: left;
      padding: 10px;
    }
    th {
      background: #f2f2f2;
    }
    .actions button {
      margin-right: 5px;
      background: #007bff;
      border: none;
      color: white;
      padding: 6px 10px;
      border-radius: 4px;
      font-size: 12px;
    }
    .actions button.delete {
      background: #dc3545;
    }
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .filters {
      display: flex;
      gap: 10px;
    }
    .filters input, .filters select {
      width: 150px;
    }
  </style>
</head>
<body>
  <header>Vadisi Reports</header>
  <div class="container">
    <section id="addReport">
      <h2>Add Report</h2>
      <form id="reportForm">
        <input type="text" id="agency" placeholder="Agency" required />
        <input type="text" id="movie" placeholder="Movie" required />
        <input type="date" id="datePosted" required />
        <input type="number" id="amount" placeholder="Amount" required />
        <select id="status" required>
          <option value="">Select Status</option>
          <option value="Paid">Paid</option>
          <option value="Pending">Pending</option>
        </select>
        <button type="submit">Add Report</button>
      </form>
    </section>

    <section id="yourReports">
      <div class="top-bar">
        <h2>Your Reports</h2>
        <button id="exportPdf">Export PDF</button>
      </div>

      <div class="filters">
        <input type="text" id="filterAgency" placeholder="Filter by Agency" />
        <input type="text" id="filterMovie" placeholder="Filter by Movie" />
        <input type="date" id="filterDate" />
        <select id="filterStatus">
          <option value="">All Status</option>
          <option value="Paid">Paid</option>
          <option value="Pending">Pending</option>
        </select>
      </div>

      <table id="reportsTable">
        <thead>
          <tr>
            <th>Agency</th>
            <th>Movie</th>
            <th>Date Posted</th>
            <th>Amount</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import {
      getFirestore, collection, addDoc, onSnapshot,
      deleteDoc, doc, updateDoc
    } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDeuC7hS30cJHXoTGx6BbmW8g_kwLGakDA",
      authDomain: "vadisi-reports.firebaseapp.com",
      projectId: "vadisi-reports",
      storageBucket: "vadisi-reports.firebasestorage.app",
      messagingSenderId: "574994089915",
      appId: "1:574994089915:web:a83456675ac8f7c4fba69e"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const reportsRef = collection(db, "reports");

    const reportForm = document.getElementById("reportForm");
    const tableBody = document.querySelector("#reportsTable tbody");

    async function renderReports(reports) {
      tableBody.innerHTML = "";
      reports.forEach((r) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${r.agency}</td>
          <td>${r.movie}</td>
          <td>${r.datePosted}</td>
          <td>${r.amount}</td>
          <td>${r.status}</td>
          <td class="actions">
            <button class="edit">Edit</button>
            <button class="delete">Delete</button>
          </td>
        `;
        tr.querySelector(".delete").onclick = async () => await deleteDoc(doc(db, "reports", r.id));
        tr.querySelector(".edit").onclick = async () => {
          const newAgency = prompt("Agency:", r.agency);
          const newMovie = prompt("Movie:", r.movie);
          const newDate = prompt("Date Posted:", r.datePosted);
          const newAmount = prompt("Amount:", r.amount);
          const newStatus = prompt("Status (Paid/Pending):", r.status);
          if (newAgency && newMovie && newDate && newAmount && newStatus)
            await updateDoc(doc(db, "reports", r.id), {
              agency: newAgency, movie: newMovie, datePosted: newDate,
              amount: newAmount, status: newStatus
            });
        };
        tableBody.appendChild(tr);
      });
    }

    let allReports = [];
    onSnapshot(reportsRef, (snapshot) => {
      allReports = snapshot.docs.map((d) => ({ id: d.id, ...d.data() }));
      filterAndRender();
    });

    reportForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const data = {
        agency: agency.value.trim(),
        movie: movie.value.trim(),
        datePosted: datePosted.value,
        amount: amount.value.trim(),
        status: status.value
      };
      await addDoc(reportsRef, data);
      reportForm.reset();
    });

    const filterInputs = document.querySelectorAll("#filterAgency, #filterMovie, #filterDate, #filterStatus");
    filterInputs.forEach((input) => input.addEventListener("input", filterAndRender));

    function filterAndRender() {
      const agencyF = document.getElementById("filterAgency").value.toLowerCase();
      const movieF = document.getElementById("filterMovie").value.toLowerCase();
      const dateF = document.getElementById("filterDate").value;
      const statusF = document.getElementById("filterStatus").value;
      const filtered = allReports.filter(r =>
        (!agencyF || r.agency.toLowerCase().includes(agencyF)) &&
        (!movieF || r.movie.toLowerCase().includes(movieF)) &&
        (!dateF || r.datePosted === dateF) &&
        (!statusF || r.status === statusF)
      );
      renderReports(filtered);
    }

    document.getElementById("exportPdf").addEventListener("click", () => {
      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF();
      pdf.text("Vadisi Reports", 14, 10);
      let y = 20;
      allReports.forEach((r) => {
        pdf.text(`${r.agency} | ${r.movie} | ${r.datePosted} | â‚¹${r.amount} | ${r.status}`, 10, y);
        y += 8;
      });
      pdf.save("Vadisi_Reports.pdf");
    });
  </script>
</body>
</html>
